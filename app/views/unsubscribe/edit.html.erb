<h1 class='center'><%= t('unsubscribe.header') %></h1>

<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <p class="text-center">
      <%= t('unsubscribe.description') %>
    </p>

    <%# Display flash messages %>
    <% if flash[:error] %>
      <div class="alert alert-danger" role="alert">
        <%= flash[:error] %>
      </div>
    <% end %>

    <% if flash[:notice] %>
      <div class="alert alert-info" role="alert">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <%= form_with url: unsubscribe_path, method: :post, local: true do |f| %>
      <%# Hidden fields to pass the actual values %>
      <%= hidden_field_tag :email, @email %>
      <%= hidden_field_tag :token, @token %>
      <%= hidden_field_tag :issued, @issued %>

      <%# Read-only display fields %>
      <%= f.label :email, t('unsubscribe.email_label') %>
      <%= f.email_field :email, value: @email, readonly: true, 
                        class: "form-control", 
                        style: "background-color: #f5f5f5;" %>

      <%= f.label :issued, t('unsubscribe.issued_label') %>
      <%= f.text_field :issued, value: @issued, readonly: true,
                       class: "form-control",
                       style: "background-color: #f5f5f5;" %>

      <%= f.label :token, t('unsubscribe.token_label') %>
      <%= f.text_field :token, value: (@token ? "#{@token[0..8]}..." : ""), readonly: true,
                       class: "form-control",
                       style: "background-color: #f5f5f5;" %>

      <%# Optional reason field %>
      <%= f.label :reason, t('unsubscribe.reason_label') %>
      <%= f.text_area :reason, class: "form-control", rows: 3, maxlength: 500,
                      placeholder: t('unsubscribe.reason_placeholder') %>
      <small class="help-block"><%= t('unsubscribe.reason_help') %></small>

      <%# Honeypot field for bot detection %>
      <div style="display: none;">
        <%= f.text_field :website, autocomplete: 'off', tabindex: '-1' %>
      </div>

      <div class="text-center">
        <%= f.submit t('unsubscribe.submit'), class: "btn btn-primary",
                     data: { confirm: t('unsubscribe.confirm_message'),
                             disable_with: t('unsubscribe.processing') } %>
        <%= link_to t('unsubscribe.cancel'), root_path, class: "btn btn-default" %>
      </div>
    <% end %>
  </div>
</div>
