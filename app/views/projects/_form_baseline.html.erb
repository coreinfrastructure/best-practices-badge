<%# Shared partial for baseline forms (baseline-1, baseline-2, baseline-3).
    Each baseline level has a thin wrapper that renders this partial.
    If a level needs custom behavior, expand its wrapper instead of modifying this partial.

    Required locals:
      - project: the Project instance
      - view_only: boolean indicating if form is read-only
      - criteria_level: string like 'baseline-1', 'baseline-2', 'baseline-3'
%>
<% badge_hostname = (ENV['PUBLIC_HOSTNAME'] || 'localhost') %>
<% baseline_number = criteria_level.split('-').last %>
<% percentage_method = "badge_percentage_baseline_#{baseline_number}" %>
<% provide :insert_progress_bar do %>
  <div class="progress-mobile progress">
    <div class="progress-bar progress-bar-success badge-progress"
         role="progressbar" aria-valuenow="<%= project.public_send(percentage_method) || 0 %>"
         aria-valuemin="0" aria-valuemax="100">
      <%= project.public_send(percentage_method) || 0 %>%
    </div>
  </div>
<% end %>
<%= render(partial: 'form_early',
           locals:
             {
               project: project, view_only: view_only,
               criteria_level: criteria_level, badge_hostname: badge_hostname
             }) %>

<div class="row">
  <div class="col-md-12">
 <div>
  <%= bootstrap_form_for project, url: update_project_path(project, section: criteria_level) do |f| %>
    <%= render 'shared/error_messages', object: f.object %>
    <%= f.hidden_field :lock_version %>
    <%# Store automation state across save-and-continue (just field names) %>
    <%= hidden_field_tag :automated_fields, (@automated_fields || []).map { |f| f[:field] }.join(',') %>
    <%= hidden_field_tag :overridden_fields, (@overridden_fields || []).map { |f| f[:field] }.join(',') %>

  <br>

  <div class="panel-group well well-lg well-color">
    <div class="panel panel-primary">
      <%= render(partial: 'panel_header',
           locals:
             {
               panel_title: 'Basics', anchor_id: 'basics',
               by_default: 'open',
               satisfaction_data:
                 project.get_satisfaction_data(criteria_level, 'basics')
             }) %>
      <div class="panel-collapse collapse in">
        <ul class="list-group">
          <li class="list-group-item"><h3 id="section_identification"><%= t('headings.Identification') %></h3>
            <%= render(partial: 'form_basics',
                 locals:
                   {
                     project: project, view_only: view_only,
                     badge_hostname: badge_hostname, f: f,
                     criteria_level: criteria_level
                   }) %>
          </li>
        </ul>

        <% unless view_only %>
          <div class="panel-footer text-center">
            <%= t 'projects.edit.submit_cdla_permissive_20_html' %>
            <%= f.button t('projects.edit.save_and_continue'), type: 'submit', name: 'continue',
                value: 'controls', class:"btn btn-success btn-submit" %>
            <%= f.submit t('projects.edit.submit_and_exit'), class:"btn btn-success btn-submit" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="panel panel-primary">
      <%= render(partial: 'panel_header',
           locals:
             {
               panel_title: 'Controls', anchor_id: 'controls',
               by_default: 'open',
               satisfaction_data:
                 project.get_satisfaction_data(criteria_level, 'controls')
             }) %>
      <div class="panel-collapse collapse in">
        <ul class="list-group">
          <%= render_minor_status(
                criteria_level, 'General', 'Controls',
                f, project, view_only
              ) %>
        </ul>
        <% unless view_only %>
          <div class="panel-footer text-center">
            <%= t 'projects.edit.submit_cdla_permissive_20_html' %>
            <%= f.submit t('projects.edit.submit_and_exit'), class:"btn btn-success btn-submit" %>
          </div>
        <% end %>
      </div>
    </div>

  </div>
      <br>
      <div class="center">
      <% if view_only %>
        <%= t "projects.show.#{project.data_license_field}",
              user: project.user_display_name %>
      <% else %>
        <%= t 'projects.edit.submit_cdla_permissive_20_html' %>
        <%= f.button t('projects.edit.save_and_continue'), type: 'submit', name: 'continue',
          value: 'Save', class:"btn btn-success btn-submit" %>
        <%= f.submit t('projects.edit.submit_and_exit'), class:"btn btn-success btn-submit" %>
      <% end %>
      </div>
    <% end %>
  </div>
</div>
</div>
