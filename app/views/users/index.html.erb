<% require 'cgi' %>

<div class="jumbotron">
<h2 class>Users</h2>

<ul class="users">
  <% @users.each do |user| %>
    <li>
      <%= avatar_for user %>
      <%= link_to user.name, user %>
    | <%= user.provider %>
      <% if current_user&.admin? %>
        <% if user.encrypted_email? %>
    |     <a href="mailto:<%= CGI::escape(user.email_if_decryptable).html_safe %>">email
            <%= user.email_if_decryptable %></a>
        <% end %>
    |   <%= link_to "delete", user, method: :delete,
                                    data: { confirm: "Are you sure?" } %>
      <% end %>
    </li>
  <% end %>
</ul>
<%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>

<% if current_user&.admin? %>
<h2 class>New Search</h2>
<p><strong>Name search is case-insensitive and supports wildcards:</strong> Use % for zero or more characters and _ for exactly one character.</p>
<p><strong>Multiple entries:</strong> Enter one name or email per line to search for multiple users.</p>
 <%= form_for users_path, method: 'get', enforce_utf8: true do %>
  <label for="search_names"><%= 'Names (one per line)' %></label>
  <%= text_area_tag :search_names, params[:search_names], rows: 3, cols: 40, placeholder: 'User names (case-insensitive, % and _)' %>
  <label for="search_emails"><%= 'Emails (one per line)' %></label>
  <%= text_area_tag :search_emails, params[:search_emails], rows: 3, cols: 60, placeholder: 'User emails (case-insensitive exact match)' %>
  <%= submit_tag 'User Search', name: nil %>
 <% end %>
<% end %>

</div>
